{% extends 'base.html.twig' %}

{% block title %}{{ articulo.titulo }}{% endblock %}

{% block body %}
<div class="front-container">

    <h1>{{ articulo.titulo }}</h1>

    <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; color:#666;">
        <img
            src="{{ articulo.usuario.avatar
                ? asset('uploads/avatars/' ~ articulo.usuario.avatar)
                : asset('images/imagenPorDefecto.png')
            }}"
            alt="Avatar"
            style="width:40px; height:40px; border-radius:50%; object-fit:cover;"
        >

        <div>
            <div>
                Publicado el {{ articulo.fechaCreacion|date('d/m/Y') }}
            </div>
            <div>
                por
                <a href="{{ path('front_index', { usuario: articulo.usuario.id }) }}">
                    {{ articulo.usuario.nombreUsuario }}
                </a>
            </div>
        </div>
    </div>

    <div style="margin-bottom:20px;">
        <img
            src="{{ articulo.imagen
                ? asset('uploads/articulos/' ~ articulo.imagen)
                : asset('images/sinImagen.png')
            }}"
            alt="Imagen del artículo"
            style="max-width:100%; max-height:400px; border:1px solid #ccc;"
        >
    </div>

    <p style="margin-bottom:20px;">
        {{ articulo.descripcion }}
    </p>

    {# Comprar (solo si está logueado y NO es el propietario) #}
    {% if app.user and app.user != articulo.usuario %}
        <form method="post" action="{{ path('articulo_comprar', {id: articulo.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('comprar' ~ articulo.id) }}">
            <button class="front-button">
                Comprar artículo
            </button>
        </form>
    {% endif %}

    {# Editar (solo propietario) #}
    {% if app.user and app.user == articulo.usuario %}
        <p style="margin-top:20px;">
            <a href="{{ path('app_articulo_edit', {id: articulo.id}) }}">
                Editar artículo
            </a>
        </p>
    {% endif %}

    <p style="margin-top:30px;">
        <a href="{{ path('front_index') }}" class="front-button">Volver al listado</a>
        <a href="{{ path('app_mis_compras') }}" class="front-button">Volver a mis compras</a>
    </p>

</div>
{% endblock %}